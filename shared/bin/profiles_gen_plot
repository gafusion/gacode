#!/bin/bash
#==============================================================================
# profiles_gen_plot
#
# PURPOSE
#  Script to manage plotting of profiles_gen input
#==============================================================================

#==============================================================================
# Syntax validity check and help message
#
n=$#

if [ $n -eq 0 ]
then
   echo
   echo "Usage:    profiles_gen_plot [options]"
   echo 
   echo "          -i <file1>,<file2>,...,<fileN>"
   echo "          Sequence of input.profiles files."
   echo "          [Default is input.profiles in the current directory]"
   echo
   echo "          -f <filetype>"
   echo "          Output file type."
   echo "          <filetype>=emf, eps, pdf, png, ps, raw, rgba, svg, svgz"
   echo 
   echo "          -interactive"
   echo "          Use python in interactive mode.  Useful if matplotlibrc has interactive:True  "
   echo
   echo " PROFILE PLOTTING MODE:"
   echo
   echo "          -options"
   echo "          Display all possible simulated parameters to plot in"
   echo "          <file1>."
   echo 
   echo "          -plot <var1>,<var2>,...,<varN>"
   echo "          Produce plots of N parameters given."  
   echo "          Default is ne,ni_1,Te,Ti_1."
   echo 
   echo "          -r <flux-surface coordinate for plotting>"
   echo "          Choices are r,r/a,rho"
   echo
   echo " FLUX-SURFACE PLOTTING MODE:"
   echo 
   echo "          -n <integer>"
   echo "          Change number of flux surfaces to plot.  Default is 16."
   echo
   echo "          -surf"
   echo "          Produce Miller/Fourier flux surface plots."
   echo
   echo "          -msurf"
   echo "          Produce Miller flux surface plots."
   echo
   echo "          -fsurf"
   echo "          Produce Fourier flux surface plots."
   echo
   echo
   echo "EXAMPLES:"
   echo
   echo "       profiles_gen_plot -options"
   echo "       profiles_gen_plot -i input.profiles -plot bunit"
   echo "       profiles_gen_plot -surf"
   echo
fi

#==============================================================================
# Define variables for flag capture
#
INFILES=input.profiles,.,.,.,.
PLOTS=Te,Ti_1
INTERACTIVE=
FTYPE=screen

# Plot options
OPTIONS_FLAG=0
PLOT_FLAG=0
RVAR="r"

# Surface options
SURF=null
N=16
#==============================================================================

#==============================================================================
# Parse command line options
#
while [ $# -gt 0 ] ; do
  case "$1" in

  -i) shift ; INFILES=$1 ;;

  -options) OPTIONS_FLAG=1 ;;

  -plot) shift ; PLOT_FLAG=1 ; PLOTS="$1" ;;

  -r) shift ; RVAR=$1 ;;

  -surf)  SURF=both ;;
  -msurf) SURF=miller ;;
  -fsurf) SURF=fourier ;;

  -n) shift ; N=$1 ;;
  
  -f) shift ; FTYPE=$1 ;;

  -interactive) INTERACTIVE=-i ;;

   *) echo "ERROR: incorrect syntax." ; exit 1 ;;

  esac
  shift
done
#==============================================================================

PYROOT=$GACODE_ROOT/shared/python/pyrats/profiles_gen

#==============================================================================
# Give possible data to be plotted

if [ $OPTIONS_FLAG -eq 1 ]
then
  python $INTERACTIVE $PYROOT/options.py $INFILES 
  exit 0
fi
#==============================================================================

#==============================================================================
# Plot flux surfaces

if [ "$SURF" != "null" ]
then
   python $INTERACTIVE $PYROOT/fluxplot.py $INFILES $SURF $N $FTYPE
   exit 0
fi
#==============================================================================

#==============================================================================
# Plot data

if [ $PLOT_FLAG -eq 1 ]
then
   python $INTERACTIVE $PYROOT/profileplot.py $RVAR $INFILES $PLOTS $FTYPE 
   exit 0
fi
#==============================================================================

