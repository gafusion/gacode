!--------------------------------------------------
! Generate Legendre pseudospectral data on x=(-1,1) 
!
! x(n)    -> nodes 
! w(n)    -> weights with Sum(w)=2.
! d1(n,n) -> d/dx
! dl(n,n) -> d/dx (1-x^2) d/dx
!
!       1
!       /
! Note: | dx f(x) = Sum w(i) f(i)
!       /
!      -1
!---------------------------------------------------

subroutine pseudo_legendre(n,x,w,d1,dl)

  implicit none

  integer, intent(in) :: n

  real, intent(out) :: x(n)
  real, intent(out) :: w(n)
  real, intent(out) :: d1(n,n)
  real, intent(out) :: dl(n,n)

  integer :: i,j
  integer :: lwork,info
  integer, dimension(:), allocatable :: ipiv
  real, dimension(:), allocatable :: work
  real, dimension(:,:), allocatable :: c
  real, dimension(:,:), allocatable :: cp
  real, dimension(:,:), allocatable :: cl

  integer, parameter :: print_flag=0

  call gauss_legendre(-1.0,1.0,x,w,n)

  lwork = 2*n
  allocate(ipiv(n))
  allocate(work(lwork))

  allocate(c(n,n))
  allocate(cp(n,n))
  allocate(cl(n,n))

  do i=1,n
     do j=1,n
        ! d/dxi
        call pseudo_rec_legendre(j-1,x(i),c(i,j),cp(i,j))
        ! L
        cl(i,j) = -(j-1)*j*c(i,j)
     enddo
  enddo

  call DGETRF(n,n,c,n,ipiv,info)
  call DGETRI(n,c,n,ipiv,work,lwork,info)
  ! c -> C^(-1)
  call DGEMM('N','N',n,n,n,1.0,cp,n,c,n,0.0,d1,n)
  ! d1 -> (Cp C^(-1))
  call DGEMM('N','N',n,n,n,1.0,cl,n,c,n,0.0,dl,n)
  ! dl -> (L C^(-1))

  if (print_flag == 1) then
     print *
     print *,'Integration weights (x,w,e,w_e)'
     print *
     do i=1,n
        print '(i2,2x,10(1pe14.7,1x))',i,x(i),w(i)
     enddo
     print *
     print *,'Sum(w) = ',sum(w)
     print *
     print *,'Pseudospectral 1st derivative error on exp(-x)' 
     print *
     do i=1,n
        print '(i2,2x,10(1pe14.7,1x))',i,sum(d1(i,:)*exp(-x(:)))/(-exp(-x(i)))-1
     enddo
     print *
     print *,'Pseudospectral L-derivative error on exp(-x)' 
     print *
     do i=1,n
        print '(i2,2x,10(1pe14.7,1x))',i,sum(dl(i,:)*exp(-x(:)))/(exp(-x(i))*(1.0+2.0*x(i)-x(i)**2))-1
     enddo

  endif

end subroutine pseudo_legendre

!---------------------------------------------------
! Generate Maxwell pseudospectral data on e=(0,emax) 
!
! e(n)    -> nodes 
! w(n)    -> weights with Sum(w)=1.0
! d1(n,n) -> d/dx
! d2(n,n) -> d^2/dx^2
!
! where e = emax x^2.
!
!               emax
!           2    /
! Note: -------- | de sqrt(e) exp(-e) h(x) = Sum w(i) h(i)
!       sqrt(pi) /
!                0
!----------------------------------------------------

subroutine pseudo_maxwell_new(n,emax,e,w,d1,d2,datafile)

  use math_constants

  implicit none

  character (len=*), intent(in) :: datafile

  integer, intent(in) :: n
  real, intent(in) :: emax
  integer :: i

  real, intent(out) :: e(n)
  real, intent(out) :: w(n)
  real, intent(out) :: d1(n,n)
  real, intent(out) :: d2(n,n)

  open(unit=1,file=trim(datafile),status='old')
  do i=1,n
     read(1,*) e(i),w(i)
  enddo
  do i=1,n
     read(1,*) d1(i,:)
  enddo
  do i=1,n
     read(1,*) d2(i,:)
  enddo
  close(1)

end subroutine pseudo_maxwell_new

subroutine pseudo_maxwell(n,emax,e,w,d1,d2)

  use math_constants

  implicit none

  integer, intent(in) :: n
  integer, intent(in) :: emax

  real, intent(out) :: e(n)
  real, intent(out) :: w(n)
  real, intent(out) :: d1(n,n)
  real, intent(out) :: d2(n,n)

  integer :: i,j
  real, dimension(:), allocatable :: x0
  real, dimension(:), allocatable :: w0
  real, dimension(:), allocatable :: mu
  real, dimension(:), allocatable :: nu
  real, dimension(:), allocatable :: alpha
  real, dimension(:), allocatable :: beta
  real, dimension(:), allocatable :: am
  real, dimension(:), allocatable :: bm
  real, dimension(:), allocatable :: am0
  real, dimension(:), allocatable :: bm0
  real, dimension(:), allocatable :: pn
  real, dimension(:), allocatable :: pnp

  integer :: lwork,info
  integer, dimension(:), allocatable :: ipiv
  real, dimension(:), allocatable :: work

  real, dimension(:,:), allocatable :: c
  real, dimension(:,:), allocatable :: cp
  real, dimension(:,:), allocatable :: cpp

  real, external :: pythag
  real :: xp,dum

  integer :: n_plot=256

  integer, parameter :: print_flag=0

  allocate(x0(n))
  allocate(w0(n))

  allocate(ipiv(n))
  allocate(cp(n,n))
  allocate(cpp(n,n))

  allocate(mu(0:2*n-1))
  allocate(nu(0:2*n-1))
  allocate(alpha(0:2*n-2))
  allocate(beta(0:2*n-2))
  allocate(am(n))
  allocate(bm(n))
  allocate(am0(n))
  allocate(bm0(n))
  allocate(pn(0:n-1))
  allocate(pnp(0:n-1))

  !----------------------------------------------------------------------------
  ! Get high-precision Maxima-generated moments
  !
  !         1                2
  !         /            -a x
  !  nu_j = | dx p_j(x) e    
  !         /
  !         0
  !
  !  p_j(x) are monic, shifted Legendre polynomials
  !
  call pseudo_load(emax,2*n,mu,nu)
  !----------------------------------------------------------------------------

  !----------------------------------------------------------------------------
  ! Follow approach in Press, Teukolsky, CPC 4, 423 (1990).
  !
  alpha(0) = 0.5
  beta(0)  = 0.0
  do j=1,2*n-2
     alpha(j) = 0.5
     beta(j) = 1.0/(4.0*(4.0-1.0/j**2))
  enddo

  call pseudo_orthog(n,nu,alpha,beta,am,bm)

  ! Compute eigenvalues of (symmetric, tridiagonal) Jacobi matrix

  bm0 = bm
  am0 = am
  allocate(work(2*n-2))
  allocate(c(n,n))
  call DSTEQR('I',n,am0,sqrt(bm0(2:n)),c,n,work,info)  

  ! Assign nodes and weights from solution
  do i=1,n  
     x0(i) = am0(i)  
     w0(i) = nu(0)*c(1,i)**2  
  enddo

  deallocate(c)
  deallocate(work)

  ! Energy nodes and weights
  e(:) = emax*x0(:)**2
  w(:) = w0(:)*emax**1.5*4/sqrt(pi)*x0(:)**2
  !----------------------------------------------------------------------------

  !----------------------------------------------------------------------------
  ! Pseudo-spectral derivative weights

  allocate(c(n,n))

  do j=1,n
     do i=1,n
        call pseudo_rec_maxwell(j-1,x0(i),c(i,j),cp(i,j),cpp(i,j),am,bm,n)
     enddo
  enddo

  lwork = 2*n
  allocate(work(lwork))
  call DGETRF(n,n,c,n,ipiv,info)
  call DGETRI(n,c,n,ipiv,work,lwork,info)
  deallocate(work)

  ! c -> C^(-1)
  call DGEMM('N','N',n,n,n,1.0,cp,n,c,n,0.0,d1,n)
  ! d -> (Cp C^(-1))
  call DGEMM('N','N',n,n,n,1.0,cpp,n,c,n,0.0,d2,n)
  ! d2 -> (Cpp C^(-1))
  !----------------------------------------------------------------------------

  !----------------------------------------------------------------------------
  ! Extensive diagnostics

  if (print_flag == 1) then
     print *,'Pseudospectral Node-Weight-Derivative Generator'
     print *
     print '(t2,a,f3.1)','emax = ',emax
     print *
     print *
     print *,'Modified moments from Maxima (nu)'
     print *
     do j=0,2*n-1
        print '(i2,2x,10(1pe23.16,1x))',j,nu(j)
     enddo
     print *
     print *,'Recursion Coefficients (a,b)'
     print *
     do j=1,n
        print '(i2,2x,10(1pe23.16,1x))',j-1,am(j),bm(j)
     enddo
     print *
     print *,'Integration weights (x,w,e,w_e)'
     print *
     do i=1,n
        print '(i2,2x,10(1pe14.7,1x))',i,x0(i),w0(i),e(i),w(i)
     enddo
     print *
     print *,'Sum(w) = ',sum(w)

     print *
     print *,'Discrete sum error check (integrals of monomials)'
     print *
     do j=0,2*n-2
        print '(i2,2x,1pe14.7)',j,sum(w0*x0**j)/mu(j)-1.0
     enddo

     open(unit=1,file='out',status='replace')
     open(unit=2,file='outp',status='replace')
     do i=1,n_plot
        xp = (i-1.0)/(n_plot-1.0)   
        do j=0,n-1
           call pseudo_rec_maxwell(j,xp,pn(j),pnp(j),dum,am,bm,n)
        enddo
        write(1,"(16(1pe14.7,1x))") xp,pn(:)
        write(2,"(16(1pe14.7,1x))") xp,pnp(:)
     enddo
     close(1)
     close(2)
     print *,'Pseudospectral 1st derivative error on exp(-x)' 
     print *
     do i=1,n
        print '(i2,2x,10(1pe14.7,1x))',i,sum(d1(i,:)*exp(-x0(:)))/(-exp(-x0(i)))-1.0
     enddo
     print *
     print *,'Pseudospectral 2nd derivative error on exp(-x)' 
     print *
     do i=1,n
        print '(i2,2x,10(1pe14.7,1x))',i,sum(d2(i,:)*exp(-x0(:)))/(exp(-x0(i)))-1.0
     enddo
  endif
  !----------------------------------------------------------------------------

end subroutine pseudo_maxwell

subroutine pseudo_orthog(n,nu,alpha,beta,a,b)  

  implicit none

  integer, intent(in) :: n
  real, intent(in) :: alpha(2*n-1),beta(2*n-1),nu(2*n) 
  real, intent(inout) :: a(n),b(n)  
  integer :: k,l  
  real, dimension(:,:), allocatable :: sig

  allocate(sig(2*n+1,2*n+1))  

  do l=3,2*n  
     sig(1,l) = 0.0  
  enddo
  do l=2,2*n+1  
     sig(2,l) = nu(l-1)  
  enddo
  a(1) = alpha(1)+nu(2)/nu(1)  
  b(1) = 0.0  
  do k=3,n+1  
     do l=k,2*n-k+3  
        sig(k,l) = sig(k-1,l+1)+(alpha(l-1)-a(k-2))*sig(k-1,l)  & 
             -b(k-2)*sig(k-2,l)+beta(l-1)*sig(k-1,l-1)  
     enddo
     a(k-1) = alpha(k-1)+sig(k,k+1)/sig(k,k)-sig(k-1,k)/sig(k-1,k-1)  
     b(k-1) = sig(k,k)/sig(k-1,k-1)  
  enddo

  deallocate(sig)

end subroutine pseudo_orthog

!-------------------------------------------------------
! p -> P(n,x)
! q -> P(n,x)'
!-------------------------------------------------------

subroutine pseudo_rec_legendre(n,x,p,q)

  implicit none

  integer, intent (in) :: n
  real, intent (in) :: x
  real, intent(out) :: p,q
  integer :: j
  real :: a,b
  real :: pmm,pm
  real :: qmm,qm

  if (n == 0) then
     p  = 1.0
     q  = 0.0
  else
     pmm = 0.0
     pm  = 1.0

     qmm = 0.0
     qm  = 0.0

     do j=0,n-1

        a = (2*j+1.0)/(j+1.0)
        b = j/(j+1.0)

        ! P(n,x)
        p = a*x*pm-b*pmm
        pmm = pm
        pm = p

        ! P'(n,x)
        q = a*x*qm-b*qmm + a*pmm
        qmm = qm
        qm  = q
     enddo
  endif

end subroutine pseudo_rec_legendre

real function p_legendre(n,x)

  implicit none

  integer, intent(in) :: n
  real, intent(in) :: x
  real :: p,q

  call pseudo_rec_legendre(n,x,p,q)

  p_legendre = p

end function p_legendre

!-------------------------------------------------------
! p -> Poly(n,x)
! q -> Poly(n,x)'
! r -> Poly(n,x)''
!-------------------------------------------------------
subroutine pseudo_rec_maxwell(n,x,p,q,r,am,bm,nm)

  implicit none

  integer, intent (in) :: n,nm
  real, intent (in) :: x
  real, intent (in) :: am(0:nm-1),bm(0:nm-1)
  real, intent(out) :: p,q,r
  integer :: j
  real :: pmm,pm
  real :: qmm,qm
  real :: rmm,rm

  if (n == 0) then
     p  = 1.0
     q  = 0.0
     r  = 0.0
  else
     pmm = 0.0
     pm  = 1.0
 
     qmm = 0.0
     qm  = 0.0

     rmm = 0.0
     rm  = 0.0

     do j=0,n-1

        ! P(n,x)
        p = (x-am(j))*pm-bm(j)*pmm
        pmm = pm
        pm = p

        ! P'(n,x)
        q = (x-am(j))*qm-bm(j)*qmm + pmm
        qmm = qm
        qm  = q

        ! P''(n,x)
        r = (x-am(j))*rm-bm(j)*rmm + 2*qmm
        rmm = rm
        rm  = r
     enddo
  endif

end subroutine pseudo_rec_maxwell

subroutine pseudo_load(m,n,mu0,nu0)

  implicit none

  integer, intent(in) :: m
  integer, intent(in) :: n
  real, intent(inout) :: mu0(0:n-1)
  real, intent(inout) :: nu0(0:n-1)

  real, dimension(0:24) :: mu
  real, dimension(0:24) :: nu


  if (n > 25) then
     print *,'ERROR: (pseudo_load) Invalid cutoff.'
     stop
  endif

  select case (m) 

  case (1)
     ! emax = 1
     mu(0)=7.46824132812427e-1
     mu(1)=3.160602794142788e-1
     mu(2)=1.8947234582049235e-1
     mu(3)=1.3212055882855767e-1
     mu(4)=1.0026879814501737e-1
     mu(5)=8.030139707139419e-2
     mu(6)=6.673227477682225e-2
     mu(7)=5.696447062846143e-2
     mu(8)=4.962324113315674e-2
     mu(9)=4.3918161928124544e-2
     mu(10)=3.9364864513484155e-2
     mu(11)=3.565108905490158e-2
     mu(12)=3.256703423844173e-2
     mu(13)=2.996681374368832e-2
     mu(14)=2.7746001964150047e-2
     mu(15)=2.582797562009707e-2
     mu(16)=2.4155294145404174e-2
     mu(17)=2.2684084375055402e-2
     mu(18)=2.1380279650214296e-2
     mu(19)=2.021703878977748e-2
     mu(20)=1.917293609131463e-2
     mu(21)=1.8230667312053636e-2
     mu(22)=1.737610837308246e-2
     mu(23)=1.6597619846868836e-2
     mu(24)=1.588552570472715e-2

     nu(0)=7.46824132812427e-1
     nu(1)=-5.735178699193467e-2
     nu(2)=-2.1172447917153164e-3
     nu(3)=2.070011057651028e-4
     nu(4)=9.614646328947111e-7
     nu(5)=-3.4205581253846107e-7
     nu(6)=2.3579289654322846e-9
     nu(7)=3.63696260754641e-10
     nu(8)=-5.196843120352868e-12
     nu(9)=-2.807156024342887e-13
     nu(10)=5.84926349855247e-15
     nu(11)=1.6641964872425044e-16
     nu(12)=-4.6926352228991824e-18
     nu(13)=-7.747028717227682e-20
     nu(14)=2.9720565872503135e-21
     nu(15)=2.7935064159530465e-23
     nu(16)=-1.5630745465700974e-24
     nu(17)=-7.067846708419752e-27
     nu(18)=7.038330954385692e-28
     nu(19)=5.796225928821465e-31
     nu(20)=-2.7698885812923096e-31
     nu(21)=6.131339544869848e-34
     nu(22)=9.667932698992789e-35
     nu(23)=-4.7244630379967867e-37
     nu(24)=-3.025288052493752e-38

  case (2)
     ! emax = 2
     mu(0)=5.98144006661304e-1
     mu(1)=2.1616617919084682e-1
     mu(2)=1.1570218085617286e-1
     mu(3)=7.424926878627024e-2
     mu(4)=5.294281483297646e-2
     mu(5)=4.041544797711707e-2
     mu(6)=3.234469773206741e-2
     mu(7)=2.678935115652243e-2
     mu(8)=2.27694002219648e-2
     mu(9)=1.9744881503891684e-2
     mu(10)=1.7397329690267613e-2
     mu(11)=1.5528382950576036e-2
     mu(12)=1.4008835839082767e-2
     mu(13)=1.2751328042574936e-2
     mu(14)=1.1694895667865816e-2
     mu(15)=1.0795827339859106e-2
     mu(16)=1.0022037945343647e-2
     mu(17)=9.349488550283246e-3
     mu(18)=8.759840458557329e-3
     mu(19)=8.238877667121431e-3
     mu(20)=7.77542136899414e-3
     mu(21)=7.360567526453982e-3
     mu(22)=6.987141378066065e-3
     mu(23)=6.649300586343729e-3
     mu(24)=6.342242114726699e-3

     nu(0)=5.98144006661304e-1
     nu(1)=-8.290582413980523e-2
     nu(2)=-7.733305577899576e-4
     nu(3)=4.8850468345385306e-4
     nu(4)=-1.2627026707953667e-5
     nu(5)=-1.2164482640331213e-6
     nu(6)=5.899896317711709e-8
     nu(7)=1.6460427097764857e-9
     nu(8)=-1.416874315533931e-10
     nu(9)=-8.555305754744379e-13
     nu(10)=2.3244595747541572e-13
     nu(11)=-1.4696391603395367e-15
     nu(12)=-2.8723126858464587e-16
     nu(13)=4.569575328102031e-18
     nu(14)=2.792631408541561e-19
     nu(15)=-7.118713058650576e-21
     nu(16)=-2.164293503135374e-22
     nu(17)=8.153921871270097e-24
     nu(18)=1.306079736710641e-25
     nu(19)=-7.574449582548448e-27
     nu(20)=-5.420121371689706e-29
     nu(21)=5.961702017376708e-30
     nu(22)=4.292993791482424e-33
     nu(23)=-4.07361357046993e-33
     nu(24)=1.8613208210493334e-35

  case (3)
     ! emax = 3
     mu(0)=5.043435602314387e-1
     mu(1)=1.5836882193868934e-1
     mu(2)=7.575941531059581e-2
     mu(3)=4.4491762584919126e-2
     mu(4)=2.958186292732058e-2
     mu(5)=2.1363330328635427e-2
     mu(6)=1.6353707711456494e-2
     mu(7)=1.30654856006581e-2
     mu(8)=1.0781480935388585e-2
     mu(9)=9.122802739566811e-3
     mu(10)=7.874376675105556e-3
     mu(11)=6.906826504634028e-3
     mu(12)=6.138512509716194e-3
     mu(13)=5.515808281290734e-3
     mu(14)=5.002265709741096e-3
     mu(15)=4.5723745950343875e-3
     mu(16)=4.2078195463754176e-3
     mu(17)=3.8951541921143773e-3
     mu(18)=3.62431065341969e-3
     mu(19)=3.387617848365809e-3
     mu(20)=3.1791390078516935e-3
     mu(21)=2.9942147665753716e-3
     mu(22)=2.8291417995036033e-3
     mu(23)=2.680942749465708e-3
     mu(24)=2.5471988367864884e-3

     nu(0)=5.043435602314387e-1
     nu(1)=-9.380295817703006e-2
     nu(2)=1.4478534104796023e-3
     nu(3)=6.567547706670731e-4
     nu(4)=-4.0026536642310184e-5
     nu(5)=-1.5217108611452612e-6
     nu(6)=2.0433123466681624e-7
     nu(7)=-5.486771774660153e-10
     nu(8)=-5.827296440961199e-10
     nu(9)=1.3857905767040207e-11
     nu(10)=1.0952149551217225e-12
     nu(11)=-4.851677327771853e-14
     nu(12)=-1.3594460321214347e-15
     nu(13)=1.0726346098001752e-16
     nu(14)=8.07158301744501e-19
     nu(15)=-1.775589253697889e-19
     nu(16)=9.36651289504628e-22
     nu(17)=2.3392139377021012e-22
     nu(18)=-3.693640516644147e-24
     nu(19)=-2.511805138119173e-25
     nu(20)=6.713216910616722e-27
     nu(21)=2.192450086301352e-28
     nu(22)=-9.039209607461183e-30
     nu(23)=-1.485462316874061e-31
     nu(24)=9.995447041730524e-33

  case (4)
     ! emax = 4
     mu(0)=4.410406953812108e-1
     mu(1)=1.2271054513890822e-1
     mu(2)=5.284063206155958e-2
     mu(3)=2.8388181423635284e-2
     mu(4)=1.7525782161993073e-2
     mu(5)=1.1904635850725871e-2
     mu(6)=8.664158990153896e-3
     mu(7)=6.63902202695263e-3
     mu(8)=5.291684255292888e-3
     mu(9)=4.3495671658608576e-3
     mu(10)=3.6636899261127254e-3
     mu(11)=3.147504096234299e-3
     mu(12)=2.748118787313225e-3
     mu(13)=2.4318012832596755e-3
     mu(14)=2.1762381682922183e-3
     mu(15)=1.96619738461266e-3
     mu(16)=1.7909917044561366e-3
     mu(17)=1.6429399081335477e-3
     mu(18)=1.5164025108775175e-3
     mu(19)=1.4071599322087097e-3
     mu(20)=1.312001102242331e-3
     mu(21)=1.2284449694300019e-3
     mu(22)=1.1545480322943466e-3
     mu(23)=1.0887688048407329e-3
     mu(24)=1.0298707317544742e-3

     nu(0)=4.410406953812108e-1
     nu(1)=-9.780980255169719e-2
     nu(2)=3.6368694861864953e-3
     nu(3)=7.015256455803051e-4
     nu(4)=-7.219956894308759e-5
     nu(5)=-5.952562636215111e-7
     nu(6)=3.946024492159563e-7
     nu(7)=-1.186534023550059e-8
     nu(8)=-1.141080168406519e-9
     nu(9)=7.333716060418382e-11
     nu(10)=1.6518039288906627e-12
     nu(11)=-2.4528337498553907e-13
     nu(12)=9.647182909687589e-16
     nu(13)=5.672552362362341e-16
     nu(14)=-1.2507666711103943e-17
     nu(15)=-9.633893098454636e-19
     nu(16)=3.970941129238678e-20
     nu(17)=1.1685276930501838e-21
     nu(18)=-8.527262581718542e-23
     nu(19)=-7.726218240394186e-25
     nu(20)=1.4272230012010484e-25
     nu(21)=-5.827800175217681e-28
     nu(22)=-1.9554009800090646e-28
     nu(23)=2.9515320137345985e-30
     nu(24)=2.2287752130425645e-31

  case (5)
     ! emax = 5
     mu(0)=3.957123096105135e-1
     mu(1)=9.932620530009145e-2
     mu(2)=3.889743626114281e-2
     mu(3)=1.9191446360109746e-2
     mu(4)=1.0995436178434295e-2
     mu(5)=7.002783844135352e-3
     mu(6)=4.823923389308601e-3
     mu(7)=3.527875606572664e-3
     mu(8)=2.7029516726074737e-3
     mu(9)=2.1485057853495843e-3
     mu(10)=1.7588618054381797e-3
     mu(11)=1.4747110854410378e-3
     mu(12)=1.2609532860734513e-3
     mu(13)=1.0958586026206985e-3
     mu(14)=9.6544457198694e-4
     mu(15)=8.60407343760431e-4
     mu(16)=7.743721580718631e-4
     mu(17)=7.028570501081431e-4
     mu(18)=6.426379688136206e-4
     mu(19)=5.913479902861108e-4
     mu(20)=5.472174408373323e-4
     mu(21)=5.089012806636749e-4
     mu(22)=4.7536192584985104e-4
     mu(23)=4.457881175515382e-4
     mu(24)=4.195377295461106e-4

     nu(0)=3.957123096105135e-1
     nu(1)=-9.852994950516532e-2
     nu(2)=5.523282562803611e-3
     nu(3)=6.553996679247276e-4
     nu(4)=-1.0234986876323304e-4
     nu(5)=1.5830655642830294e-6
     nu(6)=5.59945398557938e-7
     nu(7)=-3.4251061457336296e-8
     nu(8)=-1.2987896632426063e-9
     nu(9)=1.923595068490106e-10
     nu(10)=-1.1892510489538237e-12
     nu(11)=-6.39442027177101e-13
     nu(12)=2.0946619150244072e-14
     nu(13)=1.3853264032840173e-15
     nu(14)=-8.968753987031924e-17
     nu(15)=-1.6635375990106724e-18
     nu(16)=2.5078637573439266e-19
     nu(17)=-9.224757078533312e-22
     nu(18)=-5.248770448014813e-22
     nu(19)=1.071645338769192e-23
     nu(20)=8.49397164339067e-25
     nu(21)=-3.2762107080413394e-26
     nu(22)=-1.0274430931865255e-27
     nu(23)=6.969000836782968e-29
     nu(24)=7.417285282732927e-31

  case (6)
     ! emax = 6
     mu(0)=3.616081473536585e-1
     mu(1)=8.312677065194447e-2
     mu(2)=2.992744959808268e-2
     mu(3)=1.3647899093935215e-2
     mu(4)=7.275299718131806e-3
     mu(5)=4.342737016589542e-3
     mu(6)=2.824812201166056e-3
     mu(7)=1.964805826905908e-3
     mu(8)=1.441244435958003e-3
     mu(9)=1.1033078698817418e-3
     mu(10)=8.743706455796391e-4
     mu(11)=7.128605435125884e-4
     mu(12)=5.949437437258058e-4
     mu(13)=5.062978621237252e-4
     mu(14)=4.3795970764742653e-4
     mu(15)=3.841181577554829e-4
     mu(16)=3.4088695317041984e-4
     mu(17)=3.0559486228511396e-4
     mu(18)=2.763605022692316e-4
     mu(19)=2.5182961203880777e-4
     mu(20)=2.310081138707535e-4
     mu(21)=2.1315333867581643e-4
     mu(22)=1.977015178849554e-4
     mu(23)=1.8421843951680023e-4
     mu(24)=1.723652278906347e-4

     nu(0)=3.616081473536585e-1
     nu(1)=-9.767730302488478e-2
     nu(2)=7.068703505081291e-3
     nu(3)=5.523797202949552e-4
     nu(4)=-1.2702421056419352e-4
     nu(5)=4.702202256191358e-6
     nu(6)=6.447071016990892e-7
     nu(7)=-6.554179430744725e-8
     nu(8)=-5.01618329296777e-10
     nu(9)=3.536484094748967e-10
     nu(10)=-1.1355725071029146e-11
     nu(11)=-1.0791516944731235e-12
     nu(12)=7.834958763558889e-14
     nu(13)=1.50786363261677e-15
     nu(14)=-3.005532683050384e-16
     nu(15)=3.068552588192714e-18
     nu(16)=7.977789130156897e-19
     nu(17)=-2.6459908699128315e-20
     nu(18)=-1.4949299033438218e-21
     nu(19)=9.506402325285345e-23
     nu(20)=1.6533438520192253e-24
     nu(21)=-2.4114577675271262e-25
     nu(22)=7.047382940583334e-28
     nu(23)=4.7718231299088776e-28
     nu(24)=-8.993275369745602e-30

  case (7)
     ! emax = 7
     mu(0)=3.3490105817655924e-1
     mu(1)=7.13634370024604e-2
     mu(2)=2.3856369729357482e-2
     mu(3)=1.0129642288526161e-2
     mu(4)=5.046944801608424e-3
     mu(5)=2.829049084896438e-3
     mu(6)=1.737345860177686e-3
     mu(7)=1.1473151817017224e-3
     mu(8)=8.035385039778062e-4
     mu(9)=5.904742491470901e-4
     mu(10)=4.5142604073183845e-4
     mu(11)=3.566328947083132e-4
     mu(12)=2.895574630354076e-4
     mu(13)=2.4055091221037445e-4
     mu(14)=2.037403609932702e-4
     mu(15)=1.754164860993376e-4
     mu(16)=1.531588178103241e-4
     mu(17)=1.353415580024918e-4
     mu(18)=1.208441383729281e-4
     mu(19)=1.0887614846359543e-4
     mu(20)=9.886833310936552e-5
     mu(21)=9.040292883695662e-5
     mu(22)=8.316807355301142e-5
     mu(23)=7.692731920418068e-5
     mu(24)=7.149883758319618e-5

     nu(0)=3.3490105817655924e-1
     nu(1)=-9.608709208581925e-2
     nu(2)=8.30977575632364e-3
     nu(3)=4.180969871382078e-4
     nu(4)=-1.4511700730782934e-4
     nu(5)=8.369978918361116e-6
     nu(6)=6.196777242474317e-7
     nu(7)=-1.0120543617315998e-7
     nu(8)=1.611146399293689e-9
     nu(9)=5.119423241759052e-10
     nu(10)=-3.1579014223356544e-11
     nu(11)=-1.184156698269511e-12
     nu(12)=1.851267969060393e-13
     nu(13)=-1.5396266897388738e-15
     nu(14)=-6.609487350951538e-16
     nu(15)=2.538920725150713e-17
     nu(16)=1.5130524997048686e-18
     nu(17)=-1.2074985900257731e-19
     nu(18)=-1.526584203943903e-21
     nu(19)=3.8019668069609297e-22
     nu(20)=-4.409542002433896e-24
     nu(21)=-8.874783199531621e-25
     nu(22)=2.898896158597513e-26
     nu(23)=1.5297198020764946e-27
     nu(24)=-9.420783344150919e-29

  case (8)
     ! emax = 8
     mu(0)=3.133086873213071e-1
     mu(1)=6.247903358575609e-2
     mu(2)=1.9560826543337792e-2
     mu(3)=7.788912783975604e-3
     mu(4)=3.6466885626319284e-3
     mu(5)=1.9262617817499944e-3
     mu(6)=1.1186237615785707e-3
     mu(7)=7.013817539123408e-4
     mu(8)=4.684314814467177e-4
     mu(9)=3.297244627122634e-4
     mu(10)=2.4252629406987172e-4
     mu(11)=1.8511137495125768e-4
     mu(12)=1.4577041292912984e-4
     mu(13)=1.1786711696953625e-4
     mu(14)=9.747204626101099e-5
     mu(15)=8.216731310443721e-5
     mu(16)=7.041362912579081e-5
     mu(17)=6.120089886053024e-5
     mu(18)=5.384806670224574e-5
     mu(19)=4.788459697418953e-5
     mu(20)=4.297816496500984e-5
     mu(21)=3.8889331973829916e-5
     mu(22)=3.544242727266842e-5
     mu(23)=3.2506417220109146e-5
     mu(24)=2.998207496055387e-5

     nu(0)=3.133086873213071e-1
     nu(1)=-9.417531007489749e-2
     nu(2)=9.299907511132893e-3
     nu(3)=2.6965875435721537e-4
     nu(4)=-1.568169409394732e-4
     nu(5)=1.2238411585958146e-5
     nu(6)=4.7902253311593607e-7
     nu(7)=-1.3617994531177507e-7
     nu(8)=5.127747719438012e-9
     nu(9)=6.0941350774298e-10
     nu(10)=-6.20451350591167e-11
     nu(11)=-4.421117451424328e-13
     nu(12)=3.3257111397962263e-13
     nu(13)=-1.1118710284111266e-14
     nu(14)=-1.0414304180005496e-15
     nu(15)=8.120575114374506e-17
     nu(16)=1.3780524181445525e-18
     nu(17)=-3.3554411064521045e-19
     nu(18)=4.890168030083941e-21
     nu(19)=9.567167618793544e-22
     nu(20)=-3.97242218361967e-23
     nu(21)=-1.8430369291622892e-24
     nu(22)=1.548001448899025e-25
     nu(23)=1.5031444080329073e-27
     nu(24)=-4.3186028476103305e-28

  case (9)
     ! emax = 9
     mu(0)=2.954024494198404e-1
     mu(1)=5.554869945532852e-2
     mu(2)=1.6404391089764098e-2
     mu(3)=6.165221617031686e-3
     mu(4)=2.727209081400312e-3
     mu(5)=1.3631931480022258e-3
     mu(6)=7.507019779397155e-4
     mu(7)=4.4754161577370416e-4
     mu(8)=2.850835578606294e-4
     mu(9)=1.9205128456127524e-4
     mu(10)=1.356856787032769e-4
     mu(11)=9.98390578625596e-5
     mu(12)=7.606292564718704e-5
     mu(13)=5.970327168133532e-5
     mu(14)=4.807823496259734e-5
     mu(15)=3.9579777747334155e-5
     mu(16)=3.320909557512669e-5
     mu(17)=2.8325924437259276e-5
     mu(18)=2.4508045593915231e-5
     mu(19)=2.1469824210221522e-5
     mu(20)=1.9013503455428327e-5
     mu(21)=1.6999260006541717e-5
     mu(22)=1.5326320470961963e-5
     mu(23)=1.3920773114291013e-5
     mu(24)=1.2727531485858087e-5

     nu(0)=2.954024494198404e-1
     nu(1)=-9.21525252545917e-2
     nu(2)=1.0089433204408982e-2
     nu(3)=1.1773218459063224e-4
     nu(4)=-1.6289617563393682e-4
     nu(5)=1.6045487863745792e-5
     nu(6)=2.32512065842342e-7
     nu(7)=-1.6606600440105584e-7
     nu(8)=9.895166245594988e-9
     nu(9)=5.915044233038848e-10
     nu(10)=-1.0015347209107646e-10
     nu(11)=1.6389827965762874e-12
     nu(12)=4.8609704130292886e-13
     nu(13)=-3.0255093670280087e-14
     nu(14)=-1.1181322336573293e-15
     nu(15)=1.815206429588404e-16
     nu(16)=-1.7834157523469982e-18
     nu(17)=-6.747302720423687e-19
     nu(18)=2.859746347714786e-20
     nu(19)=1.582374353780696e-21
     nu(20)=-1.4491885365843096e-22
     nu(21)=-1.2242878446325574e-24
     nu(22)=4.8957066066851856e-25
     nu(23)=-8.629796341990674e-27
     nu(24)=-1.210727959068357e-27

  case (10)
     ! emax = 10
     mu(0)=2.802473905066427e-1
     mu(1)=4.9997730003511875e-2
     mu(2)=1.4010099528844014e-2
     mu(3)=4.997503003863063e-3
     mu(4)=2.0992449328384774e-3
     mu(5)=9.972306042844884e-4
     mu(6)=5.225412367214952e-4
     mu(7)=2.9689918479722227e-4
     mu(8)=1.806194363643991e-4
     mu(9)=1.1648967743076469e-4
     mu(10)=7.900874987585534e-5
     mu(11)=5.597484222725809e-5
     mu(12)=4.11848159435962e-5
     mu(13)=3.1314908848230616e-5
     mu(14)=2.450013387521328e-5
     mu(15)=1.9650439705637185e-5
     mu(16)=1.6105103918285718e-5
     mu(17)=1.3450355276385506e-5
     mu(18)=1.141934184241862e-5
     mu(19)=9.835323260622714e-6
     mu(20)=8.578378262173446e-6
     mu(21)=7.565326772498471e-6
     mu(22)=6.737300687157876e-6
     mu(23)=6.051862961624076e-6
     mu(24)=5.477899302107313e-6

     nu(0)=2.802473905066427e-1
     nu(1)=-9.012596524980949e-2
     nu(2)=1.0720267943105925e-2
     nu(3)=-3.137781262796743e-5
     nu(4)=-1.6430753156812933e-4
     nu(5)=1.9615457524747856e-5
     nu(6)=-1.0184839940774804e-7
     nu(7)=-1.8765588301988106e-7
     nu(8)=1.5598516173549876e-8
     nu(9)=4.1763870713526285e-10
     nu(10)=-1.4112514390683034e-10
     nu(11)=5.394351013942764e-12
     nu(12)=5.891031333474052e-13
     nu(13)=-6.029662186357526e-14
     nu(14)=-3.992251133230128e-16
     nu(15)=3.2157242823466986e-16
     nu(16)=-1.1071561612235722e-17
     nu(17)=-1.0211036941242728e-18
     nu(18)=8.359854566722498e-20
     nu(19)=1.2743298094619743e-21
     nu(20)=-3.616622670853606e-22
     nu(21)=6.447755845054812e-24
     nu(22)=1.0754869824653801e-24
     nu(23)=-5.172826118756131e-26
     nu(24)=-2.0662700593474262e-27

  case default

     print *,'ERROR: (pseudo_load) Invalid cutoff.'
     stop

  end select

  ! Fill only tp required length
  mu0(0:n-1) = mu(0:n-1)
  nu0(0:n-1) = nu(0:n-1)

end subroutine pseudo_load


