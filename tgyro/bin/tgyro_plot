#!/bin/bash

list="
 residual
 chi
 flux 
 fluxp 
 fluxf 
 power 
 temp 
 profiles_ion 
 profiles_elec 
 profiles_den_e 
 profiles_1fin_elec 
 profiles_1fin_ion 
 profiles_1fin_den_e"

time="-1"

n=$#

TOOLDIR=$TGYRO_DIR/tools/asymptote/src

# Can overwrite this with commandline option
SIMDIR=$PWD

if [ $n -eq 0 ]
then
   echo "Usage: tgyro_plot -g <time> [-f <file>] [-d <dir>]"
   echo " "
   echo "       <time> is the iteration to plot (-1 is minimum residual)"
   echo "       <file> is the name of a specific plotfile,"
   echo "       <dir>  is the full path to the TGYRO simdir"
   echo 
   echo " Examples:"
   echo
   echo "       tgyro_plot -t -1 -d ~/tgyro/sim/mydir"
   echo "       tgyro_plot -t 3"
   echo "       tgyro_plot -t 3 -d ~/tgyro/sim/mydir"
   echo "       tgyro_plot -h (prints list of plotfiles)"
   echo

   exit 1
fi

# Parse command line options
while [ $# -gt 0 ] ; do
  case "$1" in

  -h ) for i in $list ;
       do printf "$i\n" ; 
       done ; 
       exit 0 ;;

  -f ) shift ; list="$1" ; shift ;;

  -g ) shift ; time="$1" ; shift ;;

  -d ) shift ; SIMDIR=$1 ; shift ;;

  esac
done

echo "[Acting on directory $SIMDIR]"
echo "[Grabbing iteration $time]"

cd $TOOLDIR

# Copy path and time information to PATH:
echo "$SIMDIR" > PATH
echo "$time" >> PATH

# Run asymptote to generate series of EPS files, then
# move to working directory.
for i in $list
do
   printf "$i\n"
   asy $i
   mv $i.eps $SIMDIR
done
