#!/bin/bash
#==============================================================================
# tgyro_plot
#
# PURPOSE:
#  Plotting/listing routines for TGYRO output.
#==============================================================================

#==============================================================================
# Syntax validity check and help message
#
n=$#

if [ $n -eq 0 ]
then
  echo
  echo "Usage:    tgyro_plot [options]"
  echo
  echo "          -p <path>"
  echo "          Set optional path to simulation directory."
  echo "          [The default path is the current directory]"
  echo
  echo "          -e <simdir>"
  echo "          Use data in <simdir>."
  echo 
  echo "         -ext <plot extension=screen,pdf,png,dump (default screen)>"
  echo 
  echo "          -u <units>"
  echo "          Plot units (0=GB,1=Physical)."
  echo 
  echo "          -plot <type>"
  echo "          Generate plot of given type."
  echo "           <type> = flux,"
  echo "                    flux_tot,"
  echo "                    profile,"
  echo "                    profile_smooth,"
  echo "                    one."
  echo
  echo "          -func <func>"
  echo "          <func> = quantity to plot with -plot one."
  echo
  echo "          -dots"
  echo "          Toggle dot overlay."
  echo
  echo "          -i"
  echo "          Use python in interactive mode.  Useful if matplotlibrc has interactive:True  "
  echo
  echo "Example:"
  echo
  echo "   tgyro_plot -e . -plot flux_tot"
  echo "   tgyro_plot -e . -plot one -func a/Lp"

  exit 1
fi
#==============================================================================

#==============================================================================
# Define variables for flag capture
#
# Default simulation directory
LOCDIR=.
EXT=screen
SIMROOT=$PWD
PLOT_TYPE=null
UNITS=0
DOTS=0
FUNC=null
#==============================================================================

#==============================================================================
# Parse command line options
#
while [ $# -gt 0 ] ; do
  case "$1" in

  -plot) shift ; PLOT_TYPE=$1 ;;
  
  -e) shift ; LOCDIR=$1 ;;

  -p) shift ; SIMROOT=$1 ;;

  -ext) shift ; EXT=$1 ;;

  -func) shift ; FUNC=$1 ;;

  -u) shift ; UNITS=$1 ;;

  -dots) DOTS=1 ;;
  
  *) echo "ERROR: incorrect tgyro_plot syntax." ; exit 1 ;;

  esac
  shift
done
#==============================================================================

if [ "$LOCDIR" == "." ]
then
   LOCDIR=`basename $PWD`
   cd .. ; SIMROOT=$PWD
fi
SIMDIR=$SIMROOT/$LOCDIR
cd $SIMDIR

PYROOT=$GACODE_ROOT/python/tgyro

#==============================================================================
# 
#
case "$PLOT_TYPE" in

   flux)  
	python $INTERACTIVE $PYROOT/flux.py $SIMDIR $UNITS $EXT  ;;

   flux_tot)  
	python $INTERACTIVE $PYROOT/flux_tot.py $SIMDIR $UNITS $EXT  ;;

   profile)  
	python $INTERACTIVE $PYROOT/profile.py $SIMDIR $EXT  ;;

   profile_smooth)  
	python $INTERACTIVE $PYROOT/profile_smooth.py $SIMDIR $EXT $DOTS ;;

   one)  
	python $INTERACTIVE $PYROOT/oneplot.py $SIMDIR $FUNC $EXT  ;;

   check)  
	python $PYROOT/datacheck.py $SIMDIR  ;;

   notebook)  
	python $PYROOT/notebook.py $SIMDIR $UNITS $EXT ;;

   null)
        echo "Please specify a plot type via -plot." ;;

   *)
        echo "Unrecognized plot type: $PLOT_TYPE" ;;
   
esac 

exit 0
