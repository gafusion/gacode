#!/usr/bin/env python

#-------------------------------------------------
# SCRIPT:
#  neo_reg
#
# FUNCTION:
#  Perform regression comparison.  That is, test 
#  data against known solution.
#--------------------------------------------------

import sys
import os
import string

#--------------------------------------------------
# Error tolerance
tol = 1e-4
#--------------------------------------------------

#--------------------------------------------------
n=len(sys.argv)

if n <> 2:
    print "Usage: neo_reg <testdir>"
    print 
    print "       Note that <testdir> must one of the entries"
    print "       listed by neo -g" 
    sys.exit(0)
#--------------------------------------------------

testdir=sys.argv[1]+'/'
checkdir=os.environ.get('GACODE_ROOT')+'/neo/tools/input/'+testdir

check1='out.neo.check'
#regress=sys.argv[1]+'/regress'
regtext=''

#--------------------------------------------------
# Known data
#
if os.path.isfile(checkdir+check1) == 0:
	print "Regression data does not exist for "+checkdir+check1
	sys.exit(0)

# Get regression text string
#for line in open(path+'/tools/input/'+regress,'r').readlines():
#    regtext = string.strip(line)

# Get correct checksum from check.out:
for line in open(checkdir+check1,'r').readlines():
    line = string.strip(line)

data = string.splitfields(line,' ')
x1=eval(data[0])
#--------------------------------------------------

#--------------------------------------------------
# Data in question
#
if os.path.isfile(testdir+check1) == 0:
	print "Regression data does not exist for "+testdir+check1
	sys.exit(0)

for line in open(testdir+check1,'r').readlines():
    line = string.strip(line)

data = string.splitfields(line,' ')
y1=eval(data[0])
#--------------------------------------------------

#--------------------------------------------------
# Perform comparison
#
# Test 1:

p = 0

if x1 == 0.0: 
   if y1 == 0.0:
      print sys.argv[1]+": PASS  "+regtext
      p = p+1
   else:
      print sys.argv[1]+": FAIL  "+regtext
else:

   z=abs((x1-y1))/x1

   if z < tol:
      print sys.argv[1]+": PASS  "+regtext
      p = p+1
   else:
      print sys.argv[1]+": FAIL  "+regtext
#--------------------------------------------------



