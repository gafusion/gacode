#! /usr/bin/env bash
# GACODE Parallel execution script
# Needed with ibrun, but not with Intel MPI directly

#env 1>&2

#echo $MPI_LOCALRANKID
let r8=MPI_LOCALRANKID/8
let l8="$MPI_LOCALRANKID-($r8*8)"
export OMP_DEFAULT_DEVICE=${l8}

echo "`uname -n` $SLURM_PROCID $SLURM_LOCALID $OMP_DEFAULT_DEVICE `taskset -pc $$`"

exec  "$@"
