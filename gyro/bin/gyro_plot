#!/bin/bash
#==============================================================================
# gyro_plot
#
# PURPOSE:
#  Plotting/listing routines for GYRO output.
#==============================================================================

#==============================================================================
# Syntax validity check and help message
#
n=$#

if [ $n -eq 0 ]
then
  echo
  echo "Usage:    gyro_plot [options]"
  echo
  echo "          -p <path>"
  echo "          Set optional path to simulation directory."
  echo "          [The default path is the current directory]"
  echo
  echo "          -e <simdir>"
  echo "          Use data in <simdir>."
  echo
  echo "          -ext <filetype>"
  echo "           Output file type."
  echo "           <filetype>=eps, pdf, png, svg, dump"
  echo 
  echo "          -dat <datafile>"
  echo "          Toggle data dump to <datafile>."
  echo 
  echo "          -diff"
  echo "          List gyroBohm diffusivity rather than flux coefficients."
  echo
  echo "          -field <value>"
  echo "          Specify field to be plotted: [0,n_field-1]."
  echo "          Alternatively, specifying 's' returns a sum of all fields (default=s)."
  echo
  echo "          -kinetic <value>"
  echo "          Specify species to be plotted: [0,n_kinetic-1]."
  echo
  echo "          -moment <value>"
  echo "          Specify moment to be plotted: [0,3] (default=1)"
  echo
  echo "          -w <fraction>"
  echo "          Fraction of time record to use for average (default=0.8)."
  echo
  echo "          -tmax <float>"
  echo "          Maximum value of ballooning angle is applicable."
  echo
  echo "          -plot <type>"
  echo "          Generate plot of given type."
  echo "          If this keyword is omitted, data will be listed to the screen."
  echo "           <type> = freq,"
  echo "                    zf,"
  echo "                    phi_n0,"
  echo "                    gbflux,"
  echo "                    gbflux_i,"
  echo "                    gbflux_n,"
  echo "                    gbflux_exc,"
  echo "                    gbflux_rt,"
  echo "                    balloon [use -moment for indexing],"
  echo "                    fluctuation2d [-moment 0 (n, all species) "
  echo "                                   -moment 1 (v, all species) "
  echo "                                   -moment 2 (e, all species) "
  echo "                                   -moment 3 (all fields)],"
  echo "                    moment_zero"
  echo
  echo "          -ymin <float>"
  echo "          Minimum value of vertical axis (where applicable)."
  echo
  echo "          -ymax <float>"
  echo "          Maximum value of vertical axis (where applicable)."
  echo
  echo "          -lx <length>"
  echo "          Plot width"
  echo
  echo "          -ly <length>"
  echo "          Plot height"
  echo
  echo "          -title <mult>"
  echo "          Plot title"
  echo
  echo "          -x1 <val>"
  echo "          Min x to shade"
  echo
  echo "          -x2 <val>"
  echo "          Max x to shade"
  echo
  echo "Example:"
  echo
  echo "   gyro_plot -e ."
  echo "   gyro_plot -e . -plot freq"

  exit 1
fi
#==============================================================================

#==============================================================================
# Define variables for flag capture
#
# Default simulation directory
LOCDIR=.
SIMROOT=$PWD
PLOT_FLAG=0
PLOT_TYPE=gbflux
DIFF_FLAG=0
I_KINETIC=0
I_FIELD="s"
I_MOMENT=0
WINDOW=0.5
FTYPE=screen
DATAFILE=none
TMAX=-1.0
LX=12
LY=6
TITLE=null
YMIN=0.0
YMAX=auto
X1=-1.0
X2=-1.0
#==============================================================================

#==============================================================================
# Parse command line options
#
while [ $# -gt 0 ] ; do
  case "$1" in

  -plot) shift ; PLOT_FLAG=1 ; PLOT_TYPE=$1 ;;

  -diff) DIFF_FLAG=1 ;;
  
  -e) shift ; LOCDIR=$1 ;;

  -p) shift ; SIMROOT=$1 ;;

  -kinetic) shift ; I_KINETIC=$1 ;;

  -field) shift ; I_FIELD=$1 ;;

  -moment) shift ; I_MOMENT=$1 ;;

  -w) shift ; WINDOW=$1 ;;

  -tmax) shift ; TMAX=$1 ;;

  -ext) shift ; FTYPE=$1 ;;
 
  -dat) shift ; DATAFILE=$1 ;;
  
  -lx) shift ; LX=$1 ;;
  -ly) shift ; LY=$1 ;;

  -title) shift ; TITLE=$1 ;;

  -ymin) shift ; YMIN=$1 ;;
  -ymax) shift ; YMAX=$1 ;;

  -x1) shift ; X1=$1 ;;
  -x2) shift ; X2=$1 ;;
  
  *) echo "ERROR: incorrect gyro_plot syntax." ; exit 1 ;;

  esac
  shift
done
#==============================================================================

if [ "$LOCDIR" == "." ]
then
   LOCDIR=`basename $PWD`
   cd .. ; SIMROOT=$PWD
fi
SIMDIR=$SIMROOT/$LOCDIR
cd $SIMDIR

PYROOT=$GACODE_ROOT/python/gyro

#==============================================================================
# Display diff if -ldiff set, then exit.
#
if [ $PLOT_FLAG -eq 0 ]
then

   if [ $DIFF_FLAG -eq 1 ]
   then
      python $PYROOT/ldiff.py $SIMDIR $I_FIELD $I_MOMENT $WINDOW
   else
      python $PYROOT/lflux.py $SIMDIR $I_FIELD $I_MOMENT $WINDOW
   fi
   exit 0

fi

case "$PLOT_TYPE" in

   moment_zero)
	python $PYROOT/moment_zero.py $SIMDIR $I_MOMENT $WINDOW $FTYPE $DATAFILE ;;

   fluctuation2d)
	python $PYROOT/fluctuation2d.py $SIMDIR $I_MOMENT $FTYPE $DATAFILE ;;

   freq)
	python $PYROOT/data_plot_single.py $PLOT_TYPE $SIMDIR $WINDOW $FTYPE ;;

   zf)
	python $PYROOT/data_plot_single.py $PLOT_TYPE $SIMDIR $WINDOW $FTYPE ;;

   phi_n0)
	python $PYROOT/data_plot_single.py $PLOT_TYPE $SIMDIR $LX $LY $YMAX $X1 $X2 $FTYPE ;;

   gbflux)
       python $PYROOT/gbflux.py $SIMDIR $I_FIELD $I_MOMENT $WINDOW $FTYPE \
	      $DATAFILE $LX $LY $TITLE $YMIN $YMAX $X1 $X2;;

   gbflux_n)
        python $PYROOT/gbflux_n.py $SIMDIR $I_FIELD $I_MOMENT $WINDOW $FTYPE $DATAFILE ;;

   gbflux_i)
        python $PYROOT/gbflux_i.py $SIMDIR $I_FIELD $I_MOMENT $WINDOW $FTYPE $YMIN $YMAX ;;

   gbflux_rt)
        python $PYROOT/gbflux_rt.py $SIMDIR $I_FIELD $I_MOMENT $WINDOW $FTYPE $DATAFILE ;;

   gbflux_exc)
        python $PYROOT/gbflux_exc.py $SIMDIR $WINDOW $FTYPE $DATAFILE ;;

   balloon)
        python $PYROOT/data_plot_single.py $PLOT_TYPE $SIMDIR $I_MOMENT $FTYPE $TMAX ;;

   *)
        echo 'ERROR: (gyro_plot) Unrecognized argument to -plot.' ;;
esac

exit 0
