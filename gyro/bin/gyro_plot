#!/bin/bash
#==============================================================================
# gyro_plot
#
# PURPOSE:
#  Plotting/listing routines for GYRO output.
#==============================================================================

#==============================================================================
# Syntax validity check and help message
#
n=$#

if [ $n -eq 0 ]
then
  echo
  echo "Usage:   gyro_plot [options]"
  echo
  echo "         -p <path>"
  echo "         Set optional path to simulation directory."
  echo "         [The default path is the current directory]"
  echo
  echo "         -e <simdir>"
  echo "         Use data in <simdir>."
  echo
  echo "         -ext <filetype>"
  echo "         Output file type."
  echo "         <filetype>=eps, pdf, png, svg, dump"
  echo 
  echo "         -dat <datafile>"
  echo "         Toggle data dump to <datafile>."
  echo 
  echo "         -field <value>"
  echo "         Specify field to be plotted: [0,n_field-1]."
  echo "         Alternatively, specifying 's' returns a sum of all fields (default=s)."
  echo
  echo "         -kinetic <value>"
  echo "         Specify species to be plotted: [0,n_kinetic-1]."
  echo
  echo "         -moment <value>"
  echo "         Specify moment to be plotted: [0,3] (default=1)"
  echo
  echo "         -w <fraction>"
  echo "         Fraction of time record to use for average (default=0.8)."
  echo
  echo "         -tmax <float>"
  echo "         Maximum value of ballooning angle is applicable."
  echo
  echo "         -plot <type>"
  echo "         Generate plot of given type."
  echo "         If this keyword is omitted, data will be listed to the screen."
  echo "         <type> = freq,"
  echo "                    ball [use -moment for indexing],"
  echo "                    zf,"
  echo "                    phi_n0,"
  echo "                    flux,"
  echo "                    flux_i,"
  echo "                    flux_n,"
  echo "                    flux_exc,"
  echo "                    flux_rt,"
  echo "                    hmom,"
  echo "                    fluctuation2d [-moment 0 (n, all species) "
  echo "                                   -moment 1 (v, all species) "
  echo "                                   -moment 2 (e, all species) "
  echo "                                   -moment 3 (all fields)],"
  echo "                    text          [ASCII GB flux]"
  echo
  echo "         -ymin <float>"
  echo "         Minimum value of vertical axis (where applicable)."
  echo
  echo "         -ymax <float>"
  echo "         Maximum value of vertical axis (where applicable)."
  echo
  echo "         -lx <length>"
  echo "         Plot width"
  echo
  echo "         -ly <length>"
  echo "         Plot height"
  echo
  echo "         -fontsize <float>"
  echo "         Font size (default 18)."
  echo
  echo "Example:"
  echo
  echo "   gyro_plot -e ."
  echo "   gyro_plot -e . -plot freq"

  exit 1
fi
#==============================================================================

#==============================================================================
# Define variables for flag capture
#
# Default simulation directory
LOCDIR=.
SIMROOT=$PWD
PLOT_TYPE=gbflux
I_KINETIC=0
I_FIELD="s"
I_MOMENT=0
W=0.5
EXT=screen
TMAX=-1.0

FONTSIZE=18
LX=12
LY=6

YMIN=0.0
YMAX=auto
#==============================================================================

#==============================================================================
# Parse command line options
#
while [ $# -gt 0 ] ; do
  case "$1" in

  -plot) shift ; PLOT_TYPE=$1 ;;
 
  -e) shift ; LOCDIR=$1 ;;

  -p) shift ; SIMROOT=$1 ;;

  -kinetic) shift ; I_KINETIC=$1 ;;

  -field) shift ; I_FIELD=$1 ;;

  -moment) shift ; I_MOMENT=$1 ;;

  -w) shift ; W=$1 ;;

  -tmax) shift ; TMAX=$1 ;;

  -ext) shift ; EXT=$1 ;;
  
  -lx) shift ; LX=$1 ;;
  -ly) shift ; LY=$1 ;;
  -fontsize) shift ; FONTSIZE=$1 ;;

  -ymin) shift ; YMIN=$1 ;;
  -ymax) shift ; YMAX=$1 ;;

  *) echo "ERROR: incorrect gyro_plot syntax." ; exit 1 ;;

  esac
  shift
done
#==============================================================================

if [ "$LOCDIR" == "." ]
then
   LOCDIR=`basename $PWD`
   cd .. ; SIMROOT=$PWD
fi
SIMDIR=$SIMROOT/$LOCDIR
cd $SIMDIR

PYROOT=$GACODE_ROOT/python/gyro

#==============================================================================
PLT="$PYROOT/data_plot_single.py $FONTSIZE $LX $LY"

case "$PLOT_TYPE" in

   text)
        python $PYROOT/text_flux.py $W $I_FIELD $I_MOMENT ;;

   ball)
        python $PLT $PLOT_TYPE $I_MOMENT $EXT $TMAX ;;

   hmom)
	python $PLT $PLOT_TYPE $W $I_KINETIC $I_MOMENT $EXT ;;

   freq)
	python $PLT $PLOT_TYPE $W $EXT ;;

   zf)
	python $PLT $PLOT_TYPE $W $EXT ;;

   phi_n0)
	python $PLT $PLOT_TYPE $YMAX $EXT ;;

   flux)
       python $PLT $PLOT_TYPE $W $I_FIELD $I_MOMENT $YMIN $YMAX $EXT ;;

   flux_i)
        python $PLT $PLOT_TYPE $W $I_FIELD $I_MOMENT $YMIN $YMAX $EXT ;;

   gbflux_n)
        python $PLT $PLOT_TYPE $W $I_FIELD $I_MOMENT $EXT ;;

   gbflux_rt)
        python $PLT $PLOT_TYPE $W $I_FIELD $I_MOMENT $EXT ;;

   gbflux_exc)
        python $PLT $PLOT_TYPE $W $EXT ;;

   fluctuation2d)
	python $PYROOT/fluctuation2d.py $I_MOMENT $EXT ;;

   *)
        echo 'ERROR: (gyro_plot) Unrecognized argument to -plot.' ;;
esac

exit 0
