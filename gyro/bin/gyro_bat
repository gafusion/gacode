#!/bin/bash
#
#------------------------------------------------------
# SCRIPT:
#  gyro_bat
#
# PURPOSE:
#  Generate a platform-specific batch file, and submit
#  to queue if desired.
#--------------------------------------------------------

#=============================================================
# Syntax validity check and help message 
#
n=$#

if [ $n -eq 0 ]
then
   echo
  echo "Usage:   gyro_bat [options]"
  echo
  echo "         -p <path>"
  echo "         Set optional path to simulation directory."
  echo "         [The default path is the current directory]"
  echo
  echo "         -e <simdir>" 
  echo "         Run GYRO using input data in <simdir>."
  echo
  echo "         -n <nproc>" 
  echo "         Number of cores."

  exit 1
fi
#=============================================================

#=============================================================
# Define variables for flag capture
#
CODE=gyro
# Default simulation root and gyro directory
SIMROOT=$PWD
GYRO_DIR=$GACODE_ROOT/gyro
# Default number of cores
NPROC=1
#=============================================================

#=============================================================
# Parse command line options
#
while [ $# -gt 0 ] ; do
  case "$1" in

  -p) shift ; SIMROOT=$1 ;;

  -e) shift ; LOCDIR=$1 ; EXEC_FLAG=1 ;;

  -n) shift ; NPROC=$1 ;;

   *) echo "ERROR: incorrect gyro_bat syntax." ; exit 1 ;;
 
  esac
  shift
done
#=============================================================

if [ "$LOCDIR" == "." ]
then
   LOCDIR=`basename $PWD`
   cd .. ; SIMROOT=$PWD
fi
SIMDIR=$SIMROOT/$LOCDIR

# Determine queue

cat $GACODE_ROOT/shared/batch/queue_msg.${GACODE_PLATFORM}

read queue_num

$GACODE_ROOT/shared/batch/queue_go.${GACODE_PLATFORM} $NPROC $queue_num $LOCDIR $SIMROOT $CODE

exit 0
