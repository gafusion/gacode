#!/bin/sh
#
#------------------------------------------------------
# SCRIPT:
#  gyro_bat
#
# PURPOSE:
#  Generate a platform-specific batch file, and submit
#  to queue if desired.
#--------------------------------------------------------

GYRO_DIR=$GACODE_ROOT/gyro

code=gyro

n=$#

# exit if no arguments

HELP=$GYRO_DIR/bin/HELP_BAT

if [ $n -eq 0 ]
then
   cat $HELP ;
   exit 1
fi

# determine if optional path was provided

if [ $n -eq 6 ]
then
   # set simpath to specified path
   simpath=${6}
else
   # if not specified on command line, set to default
   simpath=$GYRO_DIR/sim
fi
simdir=$simpath/${2}

# parse first argument:

case "${1}" in

   -h* | -H* | --h* | --H* )

      # help

      cat $HELP ;
      exit 1 ;;

   -e* | -E* )

      # define executable directory and CONTINUE

      if ! gyro_sim_warn $simdir
      then
         exit 1 ;
      fi ;;

   -* | * )

      # error trap

      cat $HELP ;
      exit 1 ;;

esac

# We're continuing from '-e' above, so define
# number of processors

if [ $n -eq 2 ]
then
   # set nproc if not specified on command line
   nproc=2
else
   nproc=${4}
fi

# Determine queue

cat $GACODE_ROOT/shared/batch/queue_msg.${GACODE_PLATFORM}

read queue_num

$GACODE_ROOT/shared/batch/queue_go.${GACODE_PLATFORM} $nproc $queue_num ${2} $simpath $code

exit 1
