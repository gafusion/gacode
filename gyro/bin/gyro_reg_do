#!/bin/sh
# 
# SCRIPT:
#  gyro_reg_do
#
# PURPOSE:
#  Run through full suite of GYRO regression tests
#----------------------------------------------------

n=$#

if [ $n -eq 0 ] 
then
  echo "ERROR: Need to set number of CPUs."
  exit 1
fi

# Define list of test directories:

n_proc=${1}
n_omp=${2}
reset=${3}

list="
reg01 
reg02 
reg03 
reg04 
reg05 
reg06 
reg07 
reg08 
reg09 
reg10 
reg11 
reg12 
reg13 
reg14 
reg15 
reg16 
reg17 
reg18 
reg19 
reg20 
eig01 
eig02 
gkeig01"

echo "GYRO REGRESSION TESTING:"

testdir=$PWD/gyro_regression_test
mkdir $testdir
cd $testdir

for sim in $list
do 
   gyro -g $sim -p $testdir > out
   rm -rf $sim/out.gyro.prec
   gyro -e $sim -n $n_proc -nomp $n_omp -p $testdir > out
   gyro_reg $sim
   if [ $reset -eq 1 ]
   then
      # Overwrite regression data with current data
      cp $sim/out.gyro.prec $GACODE_ROOT/gyro/tools/input/$sim
      cp $sim/out.gyro.run  $GACODE_ROOT/gyro/tools/input/$sim
   fi
done
