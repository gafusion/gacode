dnl ######################################################################
dnl
dnl File:	vorpal.m4
dnl
dnl Purpose:	Check for VORPAL defines, including IDIM and
dnl		MAX_PARTICLE_GROUP_SIZE
dnl
dnl Version: $Id$
dnl
dnl Tech-X configure system
dnl
dnl ######################################################################

dnl ######################################################################
dnl
dnl Check for IDIM=9
dnl
dnl ######################################################################

AC_ARG_WITH(idim,[  --with-idim=<value of IDIM>     set max # of non spatial particle variables], IDIM="$withval",IDIM="")
AC_MSG_CHECKING(values of IDIM)

# Extract the idim values
# echo IDIM = \'$IDIM\'
if test -n "$IDIM"; then
  idimvals=`echo $IDIM | sed 's/,/ /g'`
else
  idimvals="3 4 5 6 7 9"
fi
# echo idimvals = $idimvals

idimmax=3
for i in $idimvals; do
  if test $i -gt $idimmax; then idimmax=$i; fi
  case $i in
    1)
      AC_DEFINE([IDIM1], 1, [Define to have IDIM=1 particles])
      ;;
    2)
      AC_DEFINE([IDIM2], 1, [Define to have IDIM=2 particles])
      ;;
    3)
      AC_DEFINE([IDIM3], 1, [Define to have IDIM=3 particles])
      ;;
    4)
      AC_DEFINE([IDIM4], 1, [Define to have IDIM=4 particles])
      ;;
    5)
      AC_DEFINE([IDIM5], 1, [Define to have IDIM=5 particles])
      ;;
    6)
      AC_DEFINE([IDIM6], 1, [Define to have IDIM=6 particles])
      ;;
    7)
      AC_DEFINE([IDIM7], 1, [Define to have IDIM=7 particles])
      ;;
    9)
      AC_DEFINE(IDIM9, 1, [Define to have IDIM=9 particles])
      AC_DEFINE([HAVE_VAR_DT_PTCLS], 1,
	[Define to have variable time step particles])
      VPVARDT_LIBFLAG="-L../vpvardt -lvpvardt"
      ;;
    10)
      AC_DEFINE([IDIM10], 1, [Define to have IDIM=10 particles])
      ;;
    *)
      AC_MSG_ERROR(IDIM set to invalid value of $i. Currently must set to 1, 2, 3, 4, 5, 6, 7 or 9.)
      ;;
  esac
done
AC_MSG_RESULT($idimvals)

AC_MSG_CHECKING(values of NDIM)
# Extract the ndim values
# echo NDIM = \'$NDIM\'
if test -n "$NDIM"; then
  ndimvals=`echo $NDIM | sed 's/,/ /g'`
else
  ndimvals="1 2 3"
fi

for i in $ndimvals; do
  case $i in
    1)
      AC_DEFINE([NDIM1], 1, [Define to have NDIM=1 simulations])
      ;;
    2)
      AC_DEFINE([NDIM2], 1, [Define to have NDIM=2 simulations])
      ;;
    3)
      AC_DEFINE([NDIM3], 1, [Define to have NDIM=3 simulations])
      ;;
    *)
      AC_MSG_ERROR(NDIM set to invalid value of $i. Currently must set to 1, 2, or 3.)
      ;;
  esac
done
AC_MSG_RESULT($ndimvals)

AC_SUBST(VPVARDT_LIBFLAG)
AC_DEFINE_UNQUOTED([IDIMMAX], ${idimmax},
	[Define maximum allowed value of IDIM])
if test -n "$config_summary_file"; then
  echo >> $config_summary_file
  echo Building with ${idimmax} maximum internal particle variables \
	>> $config_summary_file
fi

# Get the maximum particle group size
AC_MSG_CHECKING(maximum size of a particle group)
AC_ARG_WITH(max-ptcl-grp-size,
	AC_HELP_STRING([--with-max-ptcl-grp-size=<value of MAX_PARTICLE_GROUP_SIZE>],
        [set max size of a particle group]),
	MAX_PARTICLE_GROUP_SIZE=$withval,
	MAX_PARTICLE_GROUP_SIZE=1024)
AC_DEFINE_UNQUOTED([MAX_PARTICLE_GROUP_SIZE], $MAX_PARTICLE_GROUP_SIZE,
[Define the maximum size of a particle group])
AC_MSG_RESULT($MAX_PARTICLE_GROUP_SIZE)

# Set the compiler for vpdatanal
if test "$HDF5_INCDIR" = "$HDF5_INCDIR_SERIAL"; then
    VPDATANAL_CXX=$CXX
else
    VPDATANAL_CXX=$SERIALCXX
fi
AC_SUBST(VPDATANAL_CXX)

# Set maximum number of cells for some features
AC_MSG_CHECKING(maximum number of cells for some features)
AC_ARG_WITH(max-num-cells,
	AC_HELP_STRING([--with-max-num-cells=<max number of cells for some features>],
        [set max number of cells for some features]),
	MAX_NUM_CELLS=$withval,
	MAX_NUM_CELLS=-1)
AC_DEFINE_UNQUOTED([MAX_NUM_CELLS], $MAX_NUM_CELLS,
[Define the maximum number of cells for some features])
AC_MSG_RESULT($MAX_NUM_CELLS)

