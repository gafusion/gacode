#!/bin/bash
#=============================================================
# cgyro_compress
#
# PURPOSE:
#  Create "small" version of CGYRO directory.
#=============================================================

if [ -d $1-s ] 
then
   echo "WARNING: (cgyro_compress) Removed old directory $1-s."
   rm -r $1-s
fi

SDIR=$1-s
echo "INFO: (cgyro) Compressing $2 -> $2-s"

# Basic content
mkdir $SDIR
cp -p $1/input.cgyro $SDIR
cp -p $1/input.cgyro.gen $SDIR/input.cgyro.gen.original
cp -p $1/out.cgyro.grids $SDIR
cp -p $1/out.cgyro.equilibrium $SDIR
cp -p $1/out.cgyro.time $SDIR
cp -p $1/out.cgyro.timing $SDIR
cp -p $1/out.cgyro.info $SDIR
cp -p $1/out.cgyro.geo $SDIR

# Linear data
if ! grep -q NONLINEAR_FLAG=1 $SDIR/input.cgyro
then
    cp -p $1/out.cgyro.freq $SDIR
    cp -p $1/out.cgyro.phib $SDIR
fi

# Compress old energy flux file into new all-flux format
if [ -f $1/out.cgyro.kxky_flux_e ]
then
    cd $1
    cgyro_plot -plot fix
fi

cp -p $1/out.cgyro.ky_flux $SDIR
if [ -f $1/out.cgyro.lky_flux_n ]
then
    cp -p $1/out.cgyro.lky_flux* $SDIR
fi

# We will have a version if NOT run through TGYRO
if [ -f $1/out.cgyro.version ]
then
    cp -p  $1/out.cgyro.version $SDIR
fi
